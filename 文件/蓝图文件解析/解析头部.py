from 蓝图格式.图标 import 图标
from 蓝图格式.蓝图 import 蓝图头部, 缩略图, url字符串, 时间戳


def 解析头部(头部字符: str) -> 蓝图头部:
    分割头部: list[str] = 头部字符.split(',')
    # 旧格式 12 段（描述在 [11]），新格式 15 段（描述在 [14]）；最后几段可能被省略，故只要求至少 12 段
    if len(分割头部) < 12:
        raise ValueError(f'蓝图格式错误: 头部应被逗号分割成至少12个区域，当前为{len(分割头部)}个。头部字符：{头部字符}')
    if len(分割头部) >= 15 and 分割头部[0] != '1':
        raise ValueError(f'蓝图格式错误: 15段格式下头部第1个参数应为1。头部字符：{头部字符}')
    if 分割头部[7] != '0':
        raise ValueError(f'蓝图格式错误: 头部第8个参数应该为0。头部字符：{头部字符}')
    # 12～15 段都可能出现，描述统一取最后一段
    缩略 = 缩略图(
        图标布局=int(分割头部[1]),
        图标1=图标(int(分割头部[2])),
        图标2=图标(int(分割头部[3])),
        图标3=图标(int(分割头部[4])),
        图标4=图标(int(分割头部[5])),
        图标5=图标(int(分割头部[6])),
        小标题=url字符串.从url构造(分割头部[10])
    )
    return 蓝图头部(
        缩略图=缩略,
        创建时间=时间戳(int(分割头部[8])),
        游戏版本=分割头部[9],
        # 仅 15 段时有 作者/自定义版本/额外新建属性（[11][12][13]），否则用空；判断放最后以兼容 12～15 段
        作者=url字符串.从url构造(分割头部[11]) if len(分割头部) >= 15 else url字符串(""),
        自定义版本=url字符串.从url构造(分割头部[12]) if len(分割头部) >= 15 else url字符串(""),
        额外新建属性=url字符串.从url构造(分割头部[13]) if len(分割头部) >= 15 else url字符串(""),
        蓝图描述=url字符串.从url构造(分割头部[-1])
    )
